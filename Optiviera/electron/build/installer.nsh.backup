# Custom NSIS script for Optiviera ERP
# Only handles process killing - file installation is handled by electron-builder

!macro customInit
  # Kill any running Optiviera processes (graceful shutdown first)
  nsExec::ExecToLog 'taskkill /IM "OptivieraERP.exe" /T'
  nsExec::ExecToLog 'taskkill /IM "Optiviera.exe" /T'
  nsExec::ExecToLog 'taskkill /IM "electron.exe" /T'

  # Wait for graceful shutdown
  Sleep 3000

  # Force kill if still running
  nsExec::ExecToLog 'taskkill /F /IM "OptivieraERP.exe" /T'
  nsExec::ExecToLog 'taskkill /F /IM "Optiviera.exe" /T'
  nsExec::ExecToLog 'taskkill /F /IM "electron.exe" /T'

  # Wait for cleanup
  Sleep 1000
!macroend

!macro customUnInstall
  # Kill processes before uninstall
  nsExec::ExecToLog 'taskkill /IM "OptivieraERP.exe" /T'
  nsExec::ExecToLog 'taskkill /IM "Optiviera.exe" /T'
  Sleep 3000

  nsExec::ExecToLog 'taskkill /F /IM "OptivieraERP.exe" /T'
  nsExec::ExecToLog 'taskkill /F /IM "Optiviera.exe" /T'
  Sleep 1000
!macroend
